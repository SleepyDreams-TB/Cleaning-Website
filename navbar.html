<nav class="bg-black shadow p-4 flex justify-between items-center">
  <div>
    <span id="username"></span>
    <a href="/index.html" class="mr-4 text-pink-600 hover:underline">Home</a>
    <a href="/services.html" class="mr-4 text-pink-600 hover:underline">Services</a>
    <a href="/About-Us.html" class="mr-4 text-pink-600 hover:underline">About Us</a>
    <a href="/ContactUs.html" class="mr-4 text-pink-600 hover:underline">Contact</a>
    <a href="/products/productsPage.html" class="mr-4 text-pink-600 hover:underline">Products</a>
    <a href="/products/cart.html" class="mr-4 text-pink-600 hover:underline">Cart</a>
  </div>
</nav>

<script>
  async function updateNavbar() {
    const usernameSpan = document.getElementById('username');
    const token = localStorage.getItem('jwt');

    if (!token) {
      usernameSpan.innerHTML = 'Guest (<a href="/login.html" class="text-pink-600 hover:underline">Login</a>)';
      return;
    }

    try {
      const res = await fetch('https://api.kingburger.site/dashboard', {
        headers: { 'Authorization': `Bearer ${token}` }
      });

      if (!res.ok) throw new Error('Unauthorized');

      const data = await res.json();

      usernameSpan.innerHTML = data.loggedIn_User;

      // Update token if backend returns a refreshed one
      if (data.token) {
        localStorage.setItem('jwt', data.token);
      }

    } catch (err) {
      console.log('User not logged in or token expired', err);
      usernameSpan.innerHTML = 'Guest (<a href="/login.html" class="text-pink-600 hover:underline">Login</a>)';
    }
  }

  updateNavbar();
</script>