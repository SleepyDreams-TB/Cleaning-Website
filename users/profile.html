<!DOCTYPE html>
<html lang="en">

<head>
  <link rel="icon" href="wipe.ico" type="image/x-icon">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sparkle Cleaning Services</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-cover bg-center bg-no-repeat bg-fixed text-gray-800"
  style="background-image: url('../assets/cleaningbg.jpg');">
  <header class="bg-black shadow p-4 flex justify-between items-center">
    <h1 class="text-pink-600 font-bold">Sparkle Clean</h1>
    <nav>
      <div id="navbar-container"></div>
    </nav>
  </header>

  <label>Username:</label>
  <input type="text" id="username" /><br>

  <label>First Name:</label>
  <input type="text" id="fname" /><br>

  <label>Last Name:</label>
  <input type="text" id="lname" /><br>

  <label>Email:</label>
  <input type="email" id="email" /><br>

  <label>Cell Number:</label>
  <input type="text" id="cellnumber" /><br>

  <label>Created Date:</label>
  <input type="text" id="createdDate" readonly /><br>
  </div>
</body>

<script src="https://cdn.jsdelivr.net/npm/jwt-decode@3.1.2/build/jwt-decode.min.js"></script>
<script>
(async () => {  // ' (async () => {})(); ' IIFE to allow async/await (IIFE = Immediately Invoked Function Expression)
  const JWT = localStorage.getItem("jwt");
  if (!JWT) {
    window.location.href = "../index.html";
    return;
  }

  // Decode JWT
  const payload = jwt_decode(JWT);
  const userId = payload.user_id;

  // Load navbar
  async function loadNavbar() {
    try {
      const response = await fetch("../navbar.html");
      const navbarHtml = await response.text();
      document.getElementById("navbar-container").innerHTML = navbarHtml;
    } catch (error) {
      console.error("Error loading navbar:", error);
    }
  }
  loadNavbar();

  // Fetch user data
  async function fetchUser() {
    try {
      const response = await fetch(`https://api.kingburger.site/api/users/${userId}`, {
        method: 'GET',
        headers: {
          'Authorization': `Bearer ${JWT}`,
          'Content-Type': 'application/json'
        }
      });

      if (!response.ok) throw new Error('Failed to fetch user');

      const user_data = await response.json();

      document.getElementById("username").value = user_data.username || "";
      document.getElementById("fname").value = user_data.fname || "";
      document.getElementById("lname").value = user_data.lname || "";
      document.getElementById("email").value = user_data.email || "";
      document.getElementById("cellnumber").value = user_data.cellnumber || "";
      document.getElementById("createdDate").value = user_data.created_at || "";

    } catch (error) {
      console.error("Error fetching user:", error);
    }
  }

  await fetchUser();
})();
</script>


</html>